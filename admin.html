<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Overhaul — Admin</title>

/* Keep this here so it looks good */
<link rel="stylesheet" href="assets/styles.css" />

<style>
  :root{
    --bg-0:#07131a;
    --bg-1:#0b1720;
    --card:#0f1f2aee;
    --ink:#e9f6ff;
    --ink-dim:#bcd5e4;
    --line:rgba(255,255,255,.10);
    --line-strong:rgba(255,255,255,.18);
    --acc:#6fd6c5;
    --warn:#ffb84a;
    --shadow: 0 6px 28px rgba(0,0,0,.45);
    --shadow-soft: 0 10px 24px rgba(0,0,0,.25);
    --radius:16px;
  }
  html,body{height:100%}
  body{
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
    color:var(--ink);
    background:
      radial-gradient(1200px 700px at 85% -10%, #113449, transparent 70%),
      linear-gradient(180deg, #0a2330, #091a24 60%, #08151b);
  }

  /* Header */
  .hdr{
    position:sticky; top:0; z-index:10;
    backdrop-filter: blur(10px);
    background: linear-gradient(180deg, rgba(9,27,36,.85), rgba(9,27,36,.65));
    border-bottom:1px solid var(--line-strong);
  }
  .hdr-inner{
    display:flex; align-items:center; justify-content:space-between;
    max-width:1100px; margin:0 auto; padding:14px 18px;
  }
  .brand{font-weight:900; letter-spacing:.3px}
  .muted{color:var(--ink-dim)}

  /* Layout */
  .page{max-width:1100px;margin:34px auto 80px;padding:0 18px}

  /* Cards */
  .card{
    background:var(--card);
    border:1px solid var(--line);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:18px;
  }

  /* Gate */
  #gate{max-width:520px;margin:22px auto 0;text-align:center}
  #pw{
    width:100%; padding:12px 14px; border-radius:12px; border:1px solid var(--line-strong);
    background:#0b202b; color:var(--ink); outline:none;
  }
  #pw:focus{border-color:var(--acc); box-shadow:0 0 0 3px rgba(111,214,197,.2)}

  /* Buttons (fallbacks in case your site CSS doesn’t include them) */
  .btn{
    display:inline-flex; align-items:center; gap:10px;
    background:#123244; color:var(--ink); border:1px solid var(--line-strong);
    border-radius:999px; padding:10px 14px; cursor:pointer;
  }
  .btn:hover{filter:brightness(1.05)}
  .btn-primary{background:#1c806f; border-color:#1c806f}
  .btn-ghost{background:transparent;border-color:var(--line-strong)}
  .btn-warning{background:#b36b00;border-color:#b36b00}

  /* Toolbar */
  .toolbar{
    position:sticky; top:64px; z-index:9;
    display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    padding:10px; margin:18px 0;
    background:linear-gradient(180deg, rgba(10,31,41,.85), rgba(10,31,41,.55));
    border:1px solid var(--line); border-radius:12px; box-shadow:var(--shadow-soft);
  }
  .spacer{flex:1}
  .search{
    display:flex; align-items:center; gap:8px; background:#0b202b; border:1px solid var(--line-strong);
    border-radius:999px; padding:6px 10px;
  }
  .search input{
    background:transparent; border:none; outline:none; color:var(--ink); width:220px;
  }

  h1{margin:0 0 6px}
  h2{margin:28px 0 12px}

  /* Tables */
  .table-wrap{margin-top:10px; overflow:auto; border-radius:12px; border:1px solid var(--line)}
  table{width:100%; border-collapse:separate; border-spacing:0}
  thead th{
    position:sticky; top:0; z-index:1;
    background:#102633; color:#cfe6ff; text-align:left; font-weight:800;
    border-bottom:1px solid var(--line-strong); padding:12px 10px; white-space:nowrap; cursor:pointer;
  }
  tbody td{
    border-bottom:1px solid var(--line);
    padding:10px 10px; color:#eaf5ff; vertical-align:top;
  }
  tbody tr:hover{background:rgba(255,255,255,.03)}
  .sort-ind{opacity:.8; font-size:.85em; margin-left:6px}

  /* Small helpers */
  .note{color:var(--ink-dim); font-size:.95rem}
  .count{font-weight:800; color:#d0f1e9}
  .pill{display:inline-block; background:#0c2a36; border:1px solid var(--line-strong); padding:2px 8px; border-radius:999px; margin-left:8px}
  .mt{margin-top:16px}
</style>
</head>
<body>

<header class="hdr">
  <div class="hdr-inner">
    <div class="brand">Overhaul <span class="muted">• Owner</span></div>
    <div class="muted">Server-backed CSV storage</div>
  </div>
</header>

<main class="page">

  <!-- Passphrase gate -->
  <section id="gate" class="card">
    <h1>Unlock admin</h1>
    <div id="admin-log" class="small" style="margin-top:8px;opacity:.8;"></div>
    <p class="note">Enter the passphrase to enter admin view.</p>
    <input id="pw" type="password" placeholder="Passphrase" />
    <div class="mt">
      <button id="go" class="btn btn-primary">Unlock</button>
    </div>
    <p class="note" style="margin-top:10px">Tip: 67</p>
  </section>

  <!-- App -->
  <section id="app" hidden>
    <div class="toolbar">
      <button class="btn" id="refresh">Refresh</button>
      <button class="btn" id="exp-wl">Export waitlist CSV</button>
      <button class="btn" id="exp-sp">Export sponsors CSV</button>
      <button class="btn btn-ghost" id="copy-wl">Copy emails (waitlist)</button>
      <button class="btn btn-ghost" id="copy-sp">Copy emails (sponsors)</button>
      <span class="spacer"></span>
      <div class="search">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.3-4.3M10.5 18a7.5 7.5 0 100-15 7.5 7.5 0 000 15z" stroke="#bcd5e4" stroke-width="2" stroke-linecap="round"/></svg>
        <input id="q" placeholder="Search rows…" />
      </div>
    </div>

    <h2>Waitlist <span id="count-wl" class="pill">0</span></h2>
    <div class="card table-wrap">
      <table id="tbl-wl"></table>
    </div>

    <h2>Sponsors <span id="count-sp" class="pill">0</span></h2>
    <div class="card table-wrap">
      <table id="tbl-sp"></table>
    </div>
  </section>
</main>

<script>
  const qs = new URLSearchParams(location.search);
  const pwInput = document.getElementById('pw');
  const logEl   = document.getElementById('admin-log'); // <div id="admin-log"></div> add this near the password box
  let KEY = (localStorage.getItem('owner_key') || qs.get('key') || '').trim();
  if (KEY) pwInput.value = KEY;

  function log(msg){ if (logEl) logEl.textContent = msg; }

  async function hit(kind){
    const url = `/api/list?kind=${encodeURIComponent(kind)}&key=${encodeURIComponent(KEY)}`;
    const r = await fetch(url, { cache: 'no-store' });
    const text = await r.text();
    if (!r.ok) throw new Error(`${r.status} ${text || r.statusText}`);
    return text;
  }

  document.getElementById('go').addEventListener('click', async () => {
    KEY = pwInput.value.trim();            // avoid stray spaces/newlines
    if (!KEY){ alert('Enter passphrase'); return; }
    log('Checking key…');

    try {
      // Try both lists; some deployments use 'sponsor' vs 'sponsors'
      const wl = await hit('waitlist');    // if this throws, we land in catch
      let sp;
      try { sp = await hit('sponsor'); } catch { sp = await hit('sponsors'); }

      // If we got here, key is correct and API is reachable
      localStorage.setItem('owner_key', KEY);
      log('Key OK. Loading tables…');


    } catch (e) {
      log(String(e.message || e));
      alert('Admin login failed: ' + String(e.message || e));
    }
  });
</script>


</body>
</html>
