<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sponsor — Overhaul</title>
  <!-- Keep your site styles -->
  <link rel="stylesheet" href="assets/styles.css" />
</head>
<body>

  <header class="section">
    <div class="container">
      <h1>Want to Sponsor the Hackathon?</h1>
      <p class="muted">Tell us a bit about your organization and how you’d like to partner.</p>
    </div>
  </header>

  <main class="section">
    <div class="container form-wrap">
      <form id="sponsor-form" class="card form-card" autocomplete="on">
        <div class="grid-2">
          <label>Organization
            <input name="company" required />
          </label>
          <label>Contact name
            <input name="name" required />
          </label>
          <label>Email
            <input name="email" type="email" required />
          </label>
          <label>Phone
            <input name="phone" />
          </label>
        </div>

        <div class="grid-2">
          <label>Subject
            <input name="subject" placeholder="Sponsorship inquiry" />
          </label>
          <label>Budget range
            <select name="budget">
              <option value="Undisclosed">Undisclosed</option>
              <option value="$500–$1,000">$500–$1,000</option>
              <option value="$1,000–$2,500">$1,000–$2,500</option>
              <option value="$2,500–$5,000">$2,500–$5,000</option>
              <option value="$5,000+">$5,000+</option>
            </select>
          </label>
        </div>

        <label>Hiring focus
          <select name="hiring">
            <option value="">Not specified</option>
            <option value="Branding / Visibility">Branding / Visibility</option>
            <option value="Recruiting">Recruiting</option>
            <option value="Both">Both</option>
          </select>
        </label>

        <label>Message
          <textarea name="message" rows="4" placeholder="Tell us what you have in mind…"></textarea>
        </label>

        <!-- optional honeypot (hidden with CSS if you want) -->
        <input type="text" name="honey" tabindex="-1" autocomplete="off" style="position:absolute;left:-9999px;opacity:0" />

        <button class="btn btn-primary magnet" type="submit">Submit sponsor interest</button>
        <div class="success" id="sp-success" hidden>Thanks! We’ll get back to you shortly.</div>
      </form>
    </div>
  </main>

  <!-- If your site uses a shared main.js, you can keep it linked. Not required for submit logic. -->
  <!-- <script src="assets/main.js" defer></script> -->

  <script>
    // POST helper
    async function postJSON(url, payload){
      const r = await fetch(url, {
        method: "POST",
        headers: { "Content-Type":"application/json" },
        body: JSON.stringify(payload)
      });
      let j = null; try { j = await r.json(); } catch(e){}
      if (!r.ok) throw new Error((j && j.error) || `HTTP ${r.status}`);
      return j || { ok:true };
    }

    const form = document.getElementById('sponsor-form');
    const okEl = document.getElementById('sp-success');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      e.stopImmediatePropagation(); // avoid double handlers from other scripts

      const fd = new FormData(form);
      const data = Object.fromEntries(fd.entries());

      // Normalize field names
      const org       = (data.company || "").trim();  // backend expects `org`
      const name      = (data.name || "").trim();
      const email     = (data.email || "").trim();
      const phone     = (data.phone || "").trim();
      const subject   = (data.subject || "").trim();
      const message   = (data.message || "").trim();
      const budget    = data.budget || "Undisclosed";
      const interests = data.hiring || "";             // map Hiring → interests
      const honey     = data.honey || "";              // honeypot (ignored server-side)

      if (!org || !name || !email){
        alert("Please provide Organization, Contact name, and Email.");
        return;
      }

      // Send both the current shape and legacy aliases so either backend accepts it
      const payload = {
        // Current/robust shape used by your /api/submit.js
        kind: "sponsor",
        data: { org, name, email, phone, subject, message, budget, interests, honey },

        // Legacy aliases (harmless if unused by backend)
        type: "sponsor",
        org, name, email, phone, subject, message,
        company: org,
        tier: budget,
        hiring: interests,
        recruiting: interests
      };

      try{
        await postJSON("/api/submit", payload);
        form.reset();
        okEl.hidden = false;
        setTimeout(() => okEl.hidden = true, 3500);
      }catch(err){
        console.error("submit ERR", err);
        alert("Could not submit (sponsor): " + err.message);
      }
    }, { capture:true }); // capture to win over any other submit listeners
  </script>
</body>
</html>
